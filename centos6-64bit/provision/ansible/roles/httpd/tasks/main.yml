# Install

- name: Download apache 2.4 repos
  get_url: url=https://repos.fedorapeople.org/repos/jkaluza/httpd24/epel-httpd24.repo
           dest=/etc/yum.repos.d/
  tags: install


- name: Install [ httpd24-httpd ]
  yum: name={{ item }} enablerepo=epel-httpd24 state=present
  with_items:
    - httpd24-httpd
    - httpd24-mod_ssl
    - httpd24-apr
  tags: install

- name: Change modify [ Conf directory ]
  file: path=/opt/rh/httpd24/
        owner={{ apache_user }}
        group={{ apache_group }}
        mode={{ permission }}
        recurse=yes
  tags: install

- name: Create [ Log directory ]
  file: path={{ log_dir }}/httpd
        state=directory
        owner={{ apache_user }}
        group={{ apache_group }}
        mode=0755

# Settings

- name: Transfer [httpd.conf]
  copy: src={{ templates_path }}/httpd.conf
        dest={{ httpd_conf_dir }}/conf/httpd.conf
  notify: Restart httpd
  tags: settings

- name: Transfer [vhost.conf]
  copy: src={{ templates_path }}/conf.d/vhost.conf
        dest={{ httpd_conf_dir }}/conf.d/vhost.conf
  notify: Restart httpd
  tags: settings

- name: Transfer [ssl.conf]
  copy: src={{ templates_path }}/conf.d/ssl.conf
        dest={{ httpd_conf_dir }}/conf.d/ssl.conf
  notify: Restart httpd
  tags: settings

- name: Transfer [server-info.conf]
  copy: src={{ templates_path }}/conf.d/server-info.conf
        dest={{ httpd_conf_dir }}/conf.d/server-info.conf
  notify: Restart httpd
  tags: settings

- name: Transfer [server-status.conf]
  copy: src={{ templates_path }}/conf.d/server-status.conf
        dest={{ httpd_conf_dir }}/conf.d/server-status.conf
  notify: Restart httpd
  tags: settings


- name: Httpd is running and enabled
  service: name=httpd24-httpd state=running enabled=yes
  tags: install

